Видео: https://drive.google.com/file/d/1m3Z8p5ePyehBivGxqDJaxrPajzLj6zhu/view?usp=sharing

Это система аутентификации пользователей на Python, использующая RabbitMQ для очередей сообщений и уведомлений по email. Система реализует функциональность регистрации пользователей и сброса пароля с верификацией на основе токенов.

## Возможности

- Регистрация пользователей с подтверждением по email
- Функциональность сброса пароля
- Аутентификация на основе токенов с истечением срока действия
- Асинхронная обработка email с использованием RabbitMQ
- Веб-фреймворк FastAPI
- HTML-шаблоны для email

## API Endpoints

- `POST /register` — регистрация пользователя
- `GET /set-password?token=...` — в форме для установки пароля
- `POST /set-password?token=...` — установка пароля 
- `POST /recover-password` — восстановление пароля

#### Примеры запросов

**Регистрация пользователя:**
```bash
curl -X POST http://localhost:5001/register -H "Content-Type: application/json" -d '{"email":"your-email@example.com"}'
```

**Восстановление пароля:**
```bash
curl -X POST http://localhost:5001/recover-password -H "Content-Type: application/json" -d '{"email":"your-email@example.com"}'
```

**Установка пароля (через API):**
```bash
curl -X POST http://localhost:5001/set-password -F "token=ВАШ_ТОКЕН" -F "password=НОВЫЙ_ПАРОЛЬ"
```

## Безопасность

- Токены на основе JWT с истечением срока действия
- SMTP через TLS

## Принцип работы

Веб приложение app на Flask принимает  http запросы от пользователей, кладет задачу в очередь RabbitMQ и отдает json response.

Фоновый обработчик worker слушает очередь RabbitMQ, получает задачи из очереди, которые туда положил app и отправляет письма пользователям.

Отправка писем происходит асинхронно и надёжно благодаря RabbitMQ.

Токены создаются в worker, проверяются в app

## Требования

- Python 3.8+
- Сервер RabbitMQ
- SMTP-сервер (Gmail SMTP)

## Настройка

1. Клонируйте репозиторий
2. Создайте виртуальное окружение:
   ```bash
   python -m venv venv
   source venv/bin/activate
   ```

3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

4. Настройка переменных окружения:
   - Файл `.env` используется для хранения конфиденциальных данных и настроек
   - Эти данные не должны попадать в репозиторий (файл `.env` добавлен в `.gitignore`)
   - Создайте файл `.env` на основе `.env.example`:
     ```bash
     cp .env.example .env
     ```
   - В файле `.env` хранятся:
     - Учетные данные SMTP (email и пароль)
     - Настройки подключения к RabbitMQ
     - Секретный ключ для JWT токенов
     - Другие конфиденциальные настройки

5. Настройка Gmail для отправки email:
   - Перейдите на https://myaccount.google.com/security
   - Включите двухэтапную аутентификацию
   - Найдите раздел "Пароли приложений"
   - Создайте новый пароль для приложения:
     - Выберите "Другое (пользовательское имя)"
     - Введите название приложения (например, "RabbitMQ Auth")
     - Используйте сгенерированный пароль в настройках SMTP

6. Отредактируйте файл `.env` с вашими настройками:
   - Установите учетные данные SMTP:
     ```
     SMTP_HOST=smtp.gmail.com
     SMTP_PORT=587
     SMTP_USER=ваш-gmail@gmail.com
     SMTP_PASSWORD=пароль-приложения-из-предыдущего-шага
     ```
   - Настройте подключение к RabbitMQ
   - Установите безопасный SECRET_KEY

## Запуск приложения

1. **Запуск воркера**  
   В отдельном терминале выполните команду:
   ```bash
   cd rabbit_mq
   ./venv/bin/python worker.py
   ```
   Воркер запустится и будет ожидать сообщения из очереди RabbitMQ.

2. **Запуск веб-приложения**  
   В другом терминале выполните команду:
   ```bash
   cd rabbit_mq
   ./venv/bin/python app.py
   ```
   Веб-приложение по адресу http://localhost:5001

3. **Тестирование**  
   Отправьте POST-запрос на регистрацию:
   ```bash
   curl -X POST http://localhost:5001/register -H "Content-Type: application/json" -d '{"email": "your-email@example.com"}'
   ```
   Если всё настроено правильно, воркер обработает сообщение и отправит письмо на указанный email.
