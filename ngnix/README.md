# FastAPI + Nginx Performance Test

## Описание
Проект реализует веб-сервис с двумя API-функциями:
1. GET /date - возвращает JSON с 10000 одинаковыми записями текущей даты
2. POST /name - возвращает JSON с 10000 одинаковыми записями имени из POST-параметра



## Установка и запуск

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Запустите сервисы:
```bash
./start_servers.sh
```

## Тестирование

1. Получение даты:
```bash
curl http://localhost:9010/date
```

2. Отправка имени:
```bash
curl -X POST -H "Content-Type: application/json" -d '{"name":"test"}' http://localhost:9010/name
```

## Тестирование производительности

Для запуска тестов производительности:
```bash
cd tests
./test_performance.sh
```

Результаты тестов будут сохранены в директории `tests/test_results/`.

## Конфигурация Nginx
- Балансировка нагрузки между тремя экземплярами приложения
- Кэширование ответов на 60 минут
- Максимальный размер кэша: 10GB
- Зона кэша: 10MB

## Результаты тестирования производительности

### GET запросы
- С 3 серверами (через nginx): 100000 запросов, 100 параллельных соединений
- С 1 сервером (без nginx): 100000 запросов, 100 параллельных соединений

Для POST запросов достаточно сделать меньше запросов, потому что они более ресурсозатратные и на этой выборке хорошо видна разница

### POST запросы
- С 3 серверами (через nginx): 10000 запросов, 10 параллельных соединений
- С 1 сервером (без nginx): 10000 запросов, 10 параллельных соединений

## Результаты тестирования производительности

### GET /date

#### С одним сервером (порт 9000)
- Время выполнения: 384.566 секунд
- Запросов в секунду: 260.03
- Среднее время отклика: 384.566 мс
- q90 запросов выполнено за: 409 мс
- q99 запросов выполнено за: 459 мс

#### С тремя серверами через nginx (порт 9010)
- Время выполнения: 9.020 секунд
- Запросов в секунду: 11086.86
- Среднее время отклика: 9.020 мс
- q90 запросов выполнено за: 9 мс
- q99 запросов выполнено за: 24 мс

### POST /name

#### С одним сервером (порт 9000)
- Время выполнения: 20.667 секунд
- Запросов в секунду: 483.87
- Среднее время отклика: 20.667 мс
- q90 запросов выполнено за: 24 мс
- q99 запросов выполнено за: 39 мс

#### С тремя серверами через nginx (порт 9010)
- Время выполнения: 7.748 секунд
- Запросов в секунду: 1290.73
- Среднее время отклика: 7.748 мс
- q90 запросов выполнено за: 11 мс
- q99 запросов выполнено за: 17 мс

## Анализ результатов

### GET запросы
- Использование nginx с кэшированием дало увеличение производительности в 42.6 раза(с 260 до 11086 запросов в секунду)
- Среднее время отклика уменьшилось в 42.6 раза (с 384.566 мс до 9.020 мс)
- q99 улучшился в 19.1 раза (с 459 мс до 24 мс)

### POST запросы
- Использование nginx с балансировкой нагрузки дало увеличение производительности в 2.67 раза(с 483.87 до 1290.73 запросов в секунду)
- Среднее время отклика уменьшилось в 2.67 раза (с 20.667 мс до 7.748 мс)
- q99 улучшился в 2.29 раза (с 39 мс до 17 мс)

## Заключение
Для GET запросов использование nginx с кэшированием дало значительное улучшение производительности(более чем в 40 раз), ведь после првого запроса ответ кешируется и последующие запросы обслуживваются из кэша.
Для POST запросов, которые не могут быть кэшированы, использование nginx с балансировкой нагрузки между 3 серверам дало улучшения производительности примерно в 2.7 раза.



